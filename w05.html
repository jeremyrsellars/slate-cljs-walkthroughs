<html><head><meta charSet="utf-8"/><title>05 Custom commands - Slate with ClojureScript</title><link rel="stylesheet" href="css/style.css?v=06B7838ADC585E3A45C5022C67BD6B81DE34D3B4"/></head><body><h1 class="title">Slate with ClojureScript</h1><div id="app"><div><h1>05 Custom commands</h1><div class="objective">Make reusable formatting commands to help keep code clear and maintainable.<span><br/>  Follow along with <a href="https://docs.slatejs.org/walkthroughs/05-executing-commands" class="slate-tutorial" target="tutorial">Slate tutorial 05 Custom commands</a> (JavaScript).</span></div><h3>Interactive Demo</h3><p class="description">Select some text and try the buttons, Ctrl+b, ctrl-` as before.</p><div id="editor-parent"><div><button>Bold</button><button>Code Block</button></div><div data-gramm="false" role="textbox" data-slate-editor="true" data-slate-node="value" contenteditable="true" style="outline:none;white-space:pre-wrap;word-wrap:break-word"><p data-slate-node="element"><span data-slate-node="text"><span data-slate-leaf="true" style="font-weight:normal"><span data-slate-string="true">A line of text in a paragraph.</span></span></span></p></div></div><div id="source"><div><div><h1></h1><div id="source"><div><div><h1></h1><div id="source"><h2>CustomEditor.isBoldMarkActive</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn is-bold-mark-active?   [editor]   (let [[match]         (es6-iterator-seq           (.nodes Editor editor                     #js {:match                          (fn [n]                             (true? (.-bold n)))                          :universal true}))]     (boolean match))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-05-executing-commands/is-bold-mark-active? ([editor])     isBoldMarkActive(editor) {     const [match] = Editor.nodes(editor, {       match: n =&gt; n.bold === true,       universal: true,     })      return !!match   }, </code></pre></div></div><div><h1></h1><div id="source"><h2>CustomEditor.isCodeBlockActive</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn is-code-block-active?   [editor]   (let [[match]         (es6-iterator-seq           (.nodes Editor editor                     #js {:match                          (fn [n]                             (= (.-type n) &quot;code&quot;))}))]     (boolean match))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-05-executing-commands/is-code-block-active? ([editor])     isCodeBlockActive(editor) {     const [match] = Editor.nodes(editor, {       match: n =&gt; n.type === &#x27;code&#x27;,     })      return !!match   }, </code></pre></div></div><div><h1></h1><div id="source"><h2>CustomEditor.toggleBoldMark</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn toggle-bold-mark   [editor]   (let [isActive (is-bold-mark-active? editor)]     (.setNodes Transforms       editor       #js { :bold (if isActive nil true)}       #js { :match (fn [n] (Text.isText n))             :split true}))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-05-executing-commands/toggle-bold-mark ([editor])     toggleBoldMark(editor) {     const isActive = CustomEditor.isBoldMarkActive(editor)     Transforms.setNodes(       editor,       { bold: isActive ? null : true },       { match: n =&gt; Text.isText(n), split: true }     )   }, </code></pre></div></div><div><h1></h1><div id="source"><h2>CustomEditor.toggleCodeBlock</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn toggle-code-block   [editor]   (let [isActive (is-code-block-active? editor)]     (.setNodes Transforms       editor       #js { :type (if isActive nil &quot;code&quot;)}       #js { :match (fn [n] (Editor.isBlock editor n))}))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-05-executing-commands/toggle-code-block ([editor])     toggleCodeBlock(editor) {     const isActive = CustomEditor.isCodeBlockActive(editor)     Transforms.setNodes(       editor,       { type: isActive ? null : &#x27;code&#x27; },       { match: n =&gt; Editor.isBlock(editor, n) }     )   }, </code></pre></div></div><h2>App</h2></div></div></div></div><h3>ClojureScript</h3><pre><code class="language-clojure">(defn App   []   (let [editor (useMemo #(withReact (createEditor))                         #js [])         [value setValue]         (useState          #js [#js {:type &quot;paragraph&quot;                    :children                    #js [#js {:text &quot;A line of text in a paragraph.&quot;}]}])         renderElement          (useCallback            (fn renderElement [props]              (case (.-type (.-element props))                &quot;code&quot; (createElement CodeElement props)                       (createElement DefaultElement props)))            #js [])         renderLeaf          (useCallback            (fn renderLeaf [props]              (createElement Leaf props))            #js [])]     ; Add a toolbar with buttons that call the same methods.     (createElement Slate       #js {:editor editor            :value value            :onChange #(setValue %)}       (createElement &quot;div&quot; #js {}         (createElement &quot;button&quot;           #js {:onMouseDown                 (fn [event]                   (.preventDefault event)                   (toggle-bold-mark editor))}           &quot;Bold&quot;)         (createElement &quot;button&quot;           #js {:onMouseDown                 (fn [event]                   (.preventDefault event)                   (toggle-code-block editor))}           &quot;Code Block&quot;))       (createElement Editable         #js{:renderElement renderElement             :renderLeaf renderLeaf             :onKeyDown             (fn onKeyDown [event]              (when (.-ctrlKey event)               (case (.-key event)                  &quot;`&quot;                (do                 (.preventDefault event)                 (toggle-code-block editor))                 &quot;b&quot;                (do                 (.preventDefault event)                 (toggle-bold-mark editor))                                ;default                nil)))})))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-05-executing-commands/App ([])   const App = () =&gt; {   const editor = useMemo(() =&gt; withReact(createEditor()), [])   const [value, setValue] = useState([     {       type: &#x27;paragraph&#x27;,       children: [{ text: &#x27;A line of text in a paragraph.&#x27; }],     },   ])    const renderElement = useCallback(props =&gt; {     switch (props.element.type) {       case &#x27;code&#x27;:         return &lt;CodeElement {...props} /&gt;       default:         return &lt;DefaultElement {...props} /&gt;     }   }, [])    const renderLeaf = useCallback(props =&gt; {     return &lt;Leaf {...props} /&gt;   }, [])    return (     // Add a toolbar with buttons that call the same methods.     &lt;Slate editor={editor} value={value} onChange={value =&gt; setValue(value)}&gt;       &lt;div&gt;         &lt;button           onMouseDown={event =&gt; {             event.preventDefault()             CustomEditor.toggleBoldMark(editor)           }}         &gt;           Bold         &lt;/button&gt;         &lt;button           onMouseDown={event =&gt; {             event.preventDefault()             CustomEditor.toggleCodeBlock(editor)           }}         &gt;           Code Block         &lt;/button&gt;       &lt;/div&gt;       &lt;Editable         editor={editor}         renderElement={renderElement}         renderLeaf={renderLeaf}         onKeyDown={event =&gt; {           if (!event.ctrlKey) {             return           }            switch (event.key) {             case &#x27;`&#x27;: {               event.preventDefault()               CustomEditor.toggleCodeBlock(editor)               break             }              case &#x27;b&#x27;: {               event.preventDefault()               CustomEditor.toggleBoldMark(editor)               break             }           }         }}       /&gt;     &lt;/Slate&gt;   ) } </code></pre></div><h3>Where to next?</h3><ul id="nav"><li class="next"><a href="w06.html" class="next">06 Saving to a database</a></li><li class="slate-tutorial"><a href="https://docs.slatejs.org/walkthroughs/05-executing-commands" class="slate-tutorial" target="tutorial">05 Custom commands</a></li><li class="source-link"><a href="https://github.com/jeremyrsellars/slate-cljs-walkthroughs/blob/master/src/slatecljs/slate_05_executing_commands.cljs#L12" class="source-link">slatecljs.slate-05-executing-commands</a></li><li class="source-link"><a href="https://github.com/jeremyrsellars/slate-cljs-walkthroughs/blob/master/src/slatecljs/slate_05_executing_commands.cljs#L57" class="source-link">CustomEditor</a></li><li class="source-link"><a href="https://github.com/jeremyrsellars/slate-cljs-walkthroughs/blob/master/src/slatecljs/slate_05_executing_commands.cljs#L169" class="source-link">&lt;App&gt;</a></li><li class="previous"><a href="w04.html" class="previous">04 Applying custom formatting</a></li></ul></div></div><script>window.location.hash = "w05";</script><script src="cljs-out/dev-main.js?v=CF22D79FE6E78E32CD67E210609E461373A9F858"></script><link rel="stylesheet" href="highlightjs/styles/obsidian.css?v=6ED475813FE4886A58B236297862FF2F181E66F7"/><script>slatecljs.common.highlight_source("force");</script><div>You might also like this <a href="https://jeremyrsellars.github.io/no-new-legacy/posts/2018-09-07-generative-testing-introduction/">blog about generative testing in Clojure</a> also by <a href="https://jeremyrsellars.github.io/">Jeremy Sellars</a>.</div></body></html>
