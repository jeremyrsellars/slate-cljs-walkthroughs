<html><head><meta charSet="utf-8"/><title>06 Saving to a database - Slate with ClojureScript</title><link rel="stylesheet" href="css/style.css?v=06B7838ADC585E3A45C5022C67BD6B81DE34D3B4"/></head><body><h1 class="title">Slate with ClojureScript</h1><div id="app"><div><h1>06 Saving to a database</h1><div class="objective">Save and load the document with a custom serialization format.<span><br/>  Follow along with <a href="https://docs.slatejs.org/walkthroughs/06-saving-to-a-database" class="slate-tutorial" target="tutorial">Slate tutorial 06 Saving to a database</a> (JavaScript).</span></div><h3>Interactive Demo</h3><p class="description">Type some text and then reload the page.  The text should be restored.</p><div id="editor-parent"><div data-gramm="false" role="textbox" data-slate-editor="true" data-slate-node="value" contenteditable="true" style="outline:none;white-space:pre-wrap;word-wrap:break-word"><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">?<br/></span></span></span></div></div></div><div id="source"><div><div><h1></h1><div id="source"><div><div><h1></h1><div id="source"><h2>Custom serializatoin as a single string</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn serialize   [value]   (string/join &quot;\n&quot;     (map       (fn [n] (.string Node n))       value))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-06-saving/serialize ([value])   // Define a serializing function that takes a value and returns a string. const serialize = value =&gt; {   return (     value       // Return the string content of each paragraph in the value&#x27;s children.       .map(n =&gt; Node.string(n))       // Join them all with line breaks denoting paragraphs.       .join(&#x27; &#x27;)   ) } </code></pre></div></div><div><h1></h1><div id="source"><h2>Custom deserialization by splitting string</h2><h3>ClojureScript</h3><pre><code class="language-clojure">(defn deserialize   [s]   (into-array     (map       (fn [line]         #js {:children #js [#js { :text line}]})       (string/split s &quot;\n&quot;)))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-06-saving/deserialize ([s])   // Define a deserializing function that takes a string and returns a value. const deserialize = string =&gt; {   // Return a value array of children derived by splitting the string.   return string.split(&#x27; &#x27;).map(line =&gt; {     return {       children: [{ text: line }],     }   }) }  </code></pre></div></div><h2>App</h2></div></div></div></div><h3>ClojureScript</h3><pre><code class="language-clojure">(defn App   []   (let [editor (useMemo #(withReact (createEditor))                         #js [])         [value setValue]         (useState          ; (js/JSON.parse (.getItem js/localStorage &quot;content&quot;))          ; Use our deserializing function to read the data from Local Storage.          (deserialize           (or (.getItem js/localStorage &quot;content&quot;)               &quot;&quot;)))]     ; Add a toolbar with buttons that call the same methods.     (createElement Slate       #js {:editor editor            :value value            :onChange             (fn [value]               (setValue value)               (.setItem js/localStorage &quot;content&quot;                 ;(.stringify js/JSON value)                 (serialize value)))}       (createElement Editable #js{})))) </code></pre><h3>JavaScript (from Slate Tutorial)</h3><pre><code class="language-javascript">  //From slatecljs.slate-06-saving/App ([])   const App = () =&gt; {   const editor = useMemo(() =&gt; withReact(createEditor()), [])   // Use our deserializing function to read the data from Local Storage.   const [value, setValue] = useState(     deserialize(localStorage.getItem(&#x27;content&#x27;)) || &#x27;&#x27;   )    return (     &lt;Slate       editor={editor}       value={value}       onChange={value =&gt; {         setValue(value)         // Serialize the value and save the string value to Local Storage.         localStorage.setItem(&#x27;content&#x27;, serialize(value))       }}     &gt;       &lt;Editable /&gt;     &lt;/Slate&gt;   ) } </code></pre></div><h3>Where to next?</h3><ul id="nav"><li class="slate-tutorial"><a href="https://docs.slatejs.org/walkthroughs/06-saving-to-a-database" class="slate-tutorial" target="tutorial">06 Saving to a database</a></li><li class="source-link"><a href="https://github.com/jeremyrsellars/slate-cljs-walkthroughs/blob/master/src/slatecljs/slate_06_saving.cljs#L12" class="source-link">slatecljs.slate-06-saving</a></li><li class="source-link"><a href="https://github.com/jeremyrsellars/slate-cljs-walkthroughs/blob/master/src/slatecljs/slate_06_saving.cljs#L74" class="source-link">&lt;App&gt;</a></li><li class="previous"><a href="w05.html" class="previous">05 Custom commands</a></li></ul></div></div><script>window.location.hash = "w06";</script><script src="cljs-out/dev-main.js?v=B7C051F1A748ACCD76D4B4296D0363D00EB480A2"></script><link rel="stylesheet" href="highlightjs/styles/obsidian.css?v=6ED475813FE4886A58B236297862FF2F181E66F7"/><script>slatecljs.common.highlight_source("force");</script><div>You might also like this <a href="https://jeremyrsellars.github.io/no-new-legacy/posts/2018-09-07-generative-testing-introduction/">blog about generative testing in Clojure</a> also by <a href="https://jeremyrsellars.github.io/">Jeremy Sellars</a>.</div></body></html>
